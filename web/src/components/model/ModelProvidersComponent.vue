<template>
  <div class="model-providers-container">
    <!-- х╖жф╛зя╝ЪхОВхХЖхИЧшби -->
    <div class="providers-sidebar">
      <!-- шЗкхоЪф╣ЙцибхЮЛхМ║хЯЯ -->
      <div class="provider-item custom-models-section" :class="{ active: selectedProvider === 'custom' }">
        <div class="provider-header" @click="selectProvider('custom')">
          <div class="provider-info">
            <div class="provider-icon custom-icon">
              <span>шЗк</span>
            </div>
            <div class="provider-details">
              <h3>шЗкхоЪф╣ЙцибхЮЛ</h3>
              <span class="provider-status"
                >{{ (configStore.config.custom_models || []).length }} ф╕кцибхЮЛ</span
              >
            </div>
          </div>
          <div class="provider-actions">
            <a-button type="text" size="small" @click.stop="prepareToAddCustomModel">
              <template #icon><EditOutlined /></template>
            </a-button>
          </div>
        </div>
      </div>

      <!-- х╖▓щЕНч╜очЪДцибхЮЛцПРф╛ЫхХЖ -->
      <div
        v-for="item in modelKeys"
        :key="item"
        class="provider-item configured-provider"
        :class="{ active: selectedProvider === item }"
        @click="selectProvider(item)"
      >
        <div class="provider-header">
          <div class="provider-info">
            <div class="provider-icon available">
              <img :src="modelIcons[item] || modelIcons.default" alt="цибхЮЛхЫ╛цаЗ" />
            </div>
            <div class="provider-details">
              <h3>{{ modelNames[item].name }}</h3>
              <span class="provider-status"
                >{{ (modelNames[item].models || []).length }} ф╕кцибхЮЛ</span
              >
            </div>
          </div>
          <div class="provider-actions">
            <a-button type="text" size="small" @click.stop="openProviderConfig(item)">
              <template #icon><SettingOutlined /></template>
            </a-button>
          </div>
        </div>
      </div>

      <!-- цЬкщЕНч╜очЪДцибхЮЛцПРф╛ЫхХЖ -->
      <div
        v-for="item in notModelKeys"
        :key="item"
        class="provider-item unconfigured-provider"
        :class="{ active: selectedProvider === item }"
        @click="selectProvider(item)"
      >
        <div class="provider-header">
          <div class="provider-info">
            <div class="provider-icon">
              <img :src="modelIcons[item] || modelIcons.default" alt="цибхЮЛхЫ╛цаЗ" />
            </div>
            <div class="provider-details">
              <h3>{{ modelNames[item].name }}</h3>
              <div class="missing-keys">
                щЬАщЕНч╜о
                <span v-for="(envKey, idx) in modelNames[item].env" :key="idx">{{ envKey }}</span>
              </div>
            </div>
          </div>
          <div class="provider-actions">
            <a-button type="text" size="small" @click.stop="openProviderConfig(item)">
              <template #icon><SettingOutlined /></template>
            </a-button>
            <a :href="modelNames[item].url" target="_blank" class="info-link">
              <InfoCircleOutlined />
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- хП│ф╛зя╝ЪцибхЮЛшпжцГЕ -->
    <div class="models-content">
      <div v-if="!selectedProvider" class="empty-state">
        <div class="empty-icon">ЁЯдЦ</div>
        <h3>щАЙцЛйцибхЮЛцПРф╛ЫхХЖ</h3>
        <p>ф╗Ох╖жф╛зхИЧшбиф╕нщАЙцЛйф╕Аф╕кцибхЮЛцПРф╛ЫхХЖцЭецЯечЬЛхЕ╢цибхЮЛхИЧшбихТМщЕНч╜о</p>
      </div>

      <!-- шЗкхоЪф╣ЙцибхЮЛшпжцГЕ -->
      <div v-else-if="selectedProvider === 'custom'" class="custom-models-content">
        <div class="content-header">
          <h2>шЗкхоЪф╣ЙцибхЮЛ</h2>
          <a-button type="primary" @click="prepareToAddCustomModel">
            <template #icon><EditOutlined /></template>
            ц╖╗хКацибхЮЛ
          </a-button>
        </div>
        <div class="models-grid">
          <div
            v-for="item in configStore.config.custom_models"
            :key="item.custom_id"
            class="model-card custom-model-card"
          >
            <div class="model-header">
              <div class="model-name" :title="item.name">{{ item.name }}</div>
              <div class="model-actions">
                <a-button type="text" size="small" @click="prepareToEditCustomModel(item)">
                  <template #icon><EditOutlined /></template>
                </a-button>
                <a-popconfirm
                  title="чбошодхИащЩдшпецибхЮЛ?"
                  @confirm="handleDeleteCustomModel(item.custom_id)"
                  okText="чбошодхИащЩд"
                  cancelText="хПЦц╢И"
                  ok-type="danger"
                >
                  <a-button type="text" size="small" danger>
                    <template #icon><DeleteOutlined /></template>
                  </a-button>
                </a-popconfirm>
              </div>
            </div>
            <div class="model-info">
              <div class="info-item">
                <span class="label">API Base:</span>
                <span class="value">{{ item.api_base }}</span>
              </div>
              <div class="info-item" v-if="item.api_key">
                <span class="label">API Key:</span>
                <span class="value">тАвтАвтАвтАвтАвтАвтАвтАв</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- хОВхХЖцибхЮЛшпжцГЕ -->
      <div v-else class="provider-models-content">
        <div class="content-header">
          <div class="header-info">
            <div class="provider-icon">
              <img :src="modelIcons[selectedProvider] || modelIcons.default" alt="цибхЮЛхЫ╛цаЗ" />
            </div>
            <div>
              <h2>{{ modelNames[selectedProvider]?.name }}</h2>
              <p class="provider-description">
                {{ modelStatus[selectedProvider] ? 'х╖▓щЕНч╜о' : 'цЬкщЕНч╜о' }} ┬╖
                {{ (modelNames[selectedProvider]?.models || []).length }} ф╕кцибхЮЛ
              </p>
            </div>
          </div>
          <div class="header-actions">
            <a-button type="primary" @click="openProviderConfig(selectedProvider)">
              <template #icon><SettingOutlined /></template>
              щЕНч╜оцибхЮЛ
            </a-button>
          </div>
        </div>

        <div v-if="modelStatus[selectedProvider]" class="models-grid">
          <div
            v-for="(model, idx) in modelNames[selectedProvider]?.models"
            :key="idx"
            class="model-card provider-model-card"
          >
            <div class="model-name">{{ model }}</div>
            <div class="model-status">хПпчФи</div>
          </div>
        </div>

        <div v-else class="unconfigured-state">
          <div class="warning-icon">тЪая╕П</div>
          <h3>цибхЮЛцПРф╛ЫхХЖцЬкщЕНч╜о</h3>
          <p>шп╖щЕНч╜оф╗еф╕ЛчОпхвГхПШщЗПхРОщЗНхРпцЬНхКбя╝Ъ</p>
          <div class="env-keys">
            <code v-for="(envKey, idx) in modelNames[selectedProvider]?.env" :key="idx">{{
              envKey
            }}</code>
          </div>
          <a-button type="primary" @click="openProviderConfig(selectedProvider)">
            члЛхН│щЕНч╜о
          </a-button>
        </div>
      </div>
    </div>

    <!-- ц╖╗хКахТМч╝Цш╛СшЗкхоЪф╣ЙцибхЮЛчЪДх╝╣чкЧ -->
    <a-modal
      class="custom-model-modal"
      :open="customModel.visible"
      :title="customModel.modelTitle"
      @ok="handleAddOrEditCustomModel"
      @cancel="handleCancelCustomModel"
      @update:open="(val) => customModel.visible = val"
      :okText="'чбошод'"
      :cancelText="'хПЦц╢И'"
      :okButtonProps="{ disabled: !customModel.name || !customModel.api_base }"
      :ok-type="'primary'"
    >
      <p>ц╖╗хКачЪДцибхЮЛцШпхЕ╝хо╣ OpenAI чЪДцибхЮЛя╝МцпФхжВ vllmя╝МOllamaуАВ</p>
      <a-form :model="customModel" layout="vertical">
        <a-form-item label="цибхЮЛID" v-if="customModel.edit_type == 'edit'" name="custom_id">
          <p class="form-item-description">ш░ГчФичЪДцибхЮЛчЪДID</p>
          <a-input :value="customModel.custom_id" @update:value="(val) => customModel.custom_id = val" disabled />
        </a-form-item>
        <a-form-item
          label="цибхЮЛхРНчз░"
          name="name"
          :rules="[{ required: true, message: 'шп╖ш╛УхЕецибхЮЛхРНчз░' }]"
        >
          <p class="form-item-description">ш░ГчФичЪДцибхЮЛчЪДхРНчз░</p>
          <a-input :value="customModel.name" @update:value="(val) => customModel.name = val" :disabled="customModel.edit_type == 'edit'" />
        </a-form-item>
        <a-form-item
          label="API Base"
          name="api_base"
          :rules="[{ required: true, message: 'шп╖ш╛УхЕеAPI Base' }]"
        >
          <p class="form-item-description">цпФхжВ <code>http://localhost:11434/v1</code></p>
          <a-input :value="customModel.api_base" @update:value="(val) => customModel.api_base = val" />
        </a-form-item>
        <a-form-item label="API KEY" name="api_key">
          <a-input-password
            :value="customModel.api_key"
            @update:value="(val) => customModel.api_key = val"
            :visibilityToggle="true"
            autocomplete="new-password"
          />
        </a-form-item>
      </a-form>
    </a-modal>

    <!-- цибхЮЛцПРф╛ЫхХЖщЕНч╜ох╝╣чкЧ -->
    <a-modal
      class="provider-config-modal"
      :open="providerConfig.visible"
      :title="`щЕНч╜о${providerConfig.providerName}цибхЮЛ`"
      @ok="saveProviderConfig"
      @cancel="cancelProviderConfig"
      @update:open="(val) => providerConfig.visible = val"
      :okText="'ф┐ЭхнШщЕНч╜о'"
      :cancelText="'хПЦц╢И'"
      :ok-type="'primary'"
      :width="800"
    >
      <div v-if="providerConfig.loading" class="modal-loading-container">
        <a-spin
          :indicator="
            h(LoadingOutlined, { style: { fontSize: '32px', color: 'var(--main-color)' } })
          "
        />
        <div class="loading-text">цнгхЬишО╖хПЦцибхЮЛхИЧшби...</div>
      </div>
      <div v-else class="modal-config-content">
        <div class="modal-config-header">
          <h3>щАЙцЛй {{ providerConfig.providerName }} чЪДцибхЮЛ</h3>
          <p class="description">
            хЛ╛щАЙцВих╕МцЬЫхЬич│╗ч╗Яф╕нхРпчФичЪДцибхЮЛя╝Мшп╖ц│ицДПя╝МхИЧшбиф╕нхПпшГ╜хМЕхРлщЭЮхп╣шпЭцибхЮЛя╝Мшп╖ф╗Фч╗ЖчФДхИлуАВ
          </p>
        </div>

        <div class="modal-models-section">
          <div class="model-search">
            <a-input :value="providerConfig.searchQuery" @update:value="(val) => providerConfig.searchQuery = val" placeholder="цРЬч┤вцибхЮЛ..." allow-clear>
              <template #prefix>
                <SearchOutlined />
              </template>
            </a-input>
          </div>

          <!-- цШ╛чд║щАЙф╕нч╗Яшобф┐бцБп -->
          <div class="selection-summary">
            <span>х╖▓щАЙцЛй {{ providerConfig.selectedModels.length }} ф╕кцибхЮЛ</span>
            <span v-if="providerConfig.searchQuery" class="filter-info">
              я╝Их╜УхЙНчнЫщАЙцШ╛чд║ {{ filteredModels.length }} ф╕кя╝Й
            </span>
          </div>

          <div class="modal-checkbox-list">
            <div v-for="(model, index) in filteredModels" :key="index" class="modal-checkbox-item">
              <a-checkbox
                :checked="providerConfig.selectedModels.includes(model.id)"
                @change="(e) => handleModelSelect(model.id, e.target.checked)"
              >
                {{ model.id }}
              </a-checkbox>
            </div>
          </div>
          <div v-if="providerConfig.allModels.length === 0" class="modal-no-models">
            <a-alert
              v-if="!modelStatus[providerConfig.provider]"
              type="warning"
              message="шп╖хЬи src/.env ф╕нщЕНч╜охп╣х║ФчЪД APIKEYя╝Мх╣╢щЗНцЦ░хРпхКицЬНхКб"
            />
            <div v-else>
              <a-alert
                type="warning"
                message="шпецПРф╛ЫхХЖцЪВцЬкщАВщЕНшО╖хПЦцибхЮЛхИЧшбичЪДцЦ╣ц│Хя╝МхжВцЮЬщЬАшжБц╖╗хКацибхЮЛя╝Мшп╖хЬи config/models.private.yml ф╕нц╖╗хКауАВ"
              />
              <img
                src="../../assets/pics/guides/how-to-add-models.png"
                alt="ц╖╗хКацибхЮЛцМЗх╝Х"
                style="width: 100%; height: 100%"
              />
            </div>
          </div>
        </div>
      </div>
    </a-modal>
  </div>
</template>

<script setup>
import { computed, reactive, watch, h, ref } from 'vue'
import { message } from 'ant-design-vue'
import {
  DeleteOutlined,
  EditOutlined,
  InfoCircleOutlined,
  SettingOutlined,
  DownCircleOutlined,
  LoadingOutlined,
  SearchOutlined
} from '@ant-design/icons-vue'
import { useConfigStore } from '@/stores/config'
import { modelIcons } from '@/utils/modelIcon'
import { chatApi } from '@/apis/auth_api'

const configStore = useConfigStore()

// щАЙф╕нчЪДцПРф╛ЫхХЖ
const selectedProvider = ref(null)

// шобчоЧх▒ЮцАз
const modelNames = computed(() => configStore.config?.model_names)
const modelStatus = computed(() => configStore.config?.model_provider_status)

// шЗкхоЪф╣ЙцибхЮЛчЫ╕хЕ│чК╢цАБ
const customModel = reactive({
  modelTitle: 'ц╖╗хКашЗкхоЪф╣ЙцибхЮЛ',
  visible: false,
  custom_id: '',
  name: '',
  api_key: '',
  api_base: '',
  edit_type: 'add'
})

// цПРф╛ЫхХЖщЕНч╜очЫ╕хЕ│чК╢цАБ
const providerConfig = reactive({
  visible: false,
  provider: '',
  providerName: '',
  models: [],
  allModels: [], // цЙАцЬЙхПпчФичЪДцибхЮЛ
  selectedModels: [], // чФицИ╖щАЙцЛйчЪДцибхЮЛ
  loading: false,
  searchQuery: ''
})

// чнЫщАЙ modelStatus ф╕нф╕║чЬЯчЪДkey
const modelKeys = computed(() => {
  return Object.keys(modelStatus.value || {}).filter((key) => modelStatus.value[key])
})

// чнЫщАЙ modelStatus ф╕нф╕║хБЗчЪДkey
const notModelKeys = computed(() => {
  return Object.keys(modelStatus.value || {}).filter((key) => !modelStatus.value[key])
})

// цибхЮЛх▒Хх╝АчК╢цАБчобчРЖ
const expandedModels = reactive({})

// чЫСхРм modelKeys хПШхМЦя╝Мчбоф┐ЭцЦ░ц╖╗хКачЪДцибхЮЛф╣ЯцШпщ╗Шшодх▒Хх╝АчК╢цАБ
watch(
  modelKeys,
  (newKeys) => {
    newKeys.forEach((key) => {
      if (expandedModels[key] === undefined) {
        expandedModels[key] = true
      }
    })
    
    // хжВцЮЬц▓бцЬЙщАЙф╕нчЪДцПРф╛ЫхХЖя╝МшЗкхКищАЙцЛйчммф╕Аф╕кхПпчФичЪД
    if (!selectedProvider.value) {
      if (configStore.config.custom_models && configStore.config.custom_models.length > 0) {
        selectedProvider.value = 'custom'
      } else if (newKeys.length > 0) {
        selectedProvider.value = newKeys[0]
      } else if (notModelKeys.value.length > 0) {
        selectedProvider.value = notModelKeys.value[0]
      }
    }
  },
  { immediate: true }
)

// щАЙцЛйцПРф╛ЫхХЖ
const selectProvider = (provider) => {
  selectedProvider.value = provider
}

// чФЯцИРщЪПцЬ║хУИх╕МхА╝
const generateRandomHash = (length) => {
  let chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'
  let hash = ''
  for (let i = 0; i < length; i++) {
    hash += chars.charAt(Math.floor(Math.random() * chars.length))
  }
  return hash
}

// хдДчРЖшЗкхоЪф╣ЙцибхЮЛхИащЩд
const handleDeleteCustomModel = (customId) => {
  const updatedModels = configStore.config.custom_models.filter(
    (item) => item.custom_id !== customId
  )
  configStore.setConfigValue('custom_models', updatedModels)
}

// хЗЖхдЗч╝Цш╛СшЗкхоЪф╣ЙцибхЮЛ
const prepareToEditCustomModel = (item) => {
  customModel.modelTitle = 'ч╝Цш╛СшЗкхоЪф╣ЙцибхЮЛ'
  customModel.custom_id = item.custom_id
  customModel.visible = true
  customModel.edit_type = 'edit'
  customModel.name = item.name
  customModel.api_key = item.api_key
  customModel.api_base = item.api_base
}

// хЗЖхдЗц╖╗хКашЗкхоЪф╣ЙцибхЮЛ
const prepareToAddCustomModel = () => {
  customModel.modelTitle = 'ц╖╗хКашЗкхоЪф╣ЙцибхЮЛ'
  customModel.edit_type = 'add'
  customModel.visible = true
  clearCustomModel()
}

// ц╕ЕщЩдшЗкхоЪф╣ЙцибхЮЛшбихНХ
const clearCustomModel = () => {
  customModel.custom_id = ''
  customModel.name = ''
  customModel.api_key = ''
  customModel.api_base = ''
}

// хПЦц╢ИшЗкхоЪф╣ЙцибхЮЛц╖╗хКа/ч╝Цш╛С
const handleCancelCustomModel = () => {
  clearCustomModel()
  customModel.visible = false
}

// ц╖╗хКацИЦч╝Цш╛СшЗкхоЪф╣ЙцибхЮЛ
const handleAddOrEditCustomModel = async () => {
  if (!customModel.name || !customModel.api_base) {
    message.error('шп╖хблхЖЩхоМцХ┤чЪДцибхЮЛхРНчз░хТМAPI Baseф┐бцБпуАВ')
    return
  }

  let custom_models = configStore.config.custom_models || []

  const model_info = {
    custom_id: customModel.custom_id || `${customModel.name}-${generateRandomHash(4)}`,
    name: customModel.name,
    api_key: customModel.api_key,
    api_base: customModel.api_base
  }

  if (customModel.edit_type === 'add') {
    if (custom_models.find((item) => item.custom_id === customModel.custom_id)) {
      message.error('цибхЮЛIDх╖▓хнШхЬи')
      return
    }
    custom_models.push(model_info)
  } else {
    // хжВцЮЬ custom_id чЫ╕хРМя╝МхИЩцЫ┤цЦ░
    custom_models = custom_models.map((item) =>
      item.custom_id === customModel.custom_id ? model_info : item
    )
  }

  customModel.visible = false
  await configStore.setConfigValue('custom_models', custom_models)
  message.success(customModel.edit_type === 'add' ? 'цибхЮЛц╖╗хКацИРхКЯ' : 'цибхЮЛф┐оцФ╣цИРхКЯ')
}

// хИЗцНвх▒Хх╝АчК╢цАБ
const toggleExpand = (item) => {
  expandedModels[item] = !expandedModels[item]
}

// хдДчРЖцибхЮЛщАЙцЛй
const handleModelSelect = (modelId, checked) => {
  const selectedModels = providerConfig.selectedModels
  const index = selectedModels.indexOf(modelId)

  if (checked && index === -1) {
    selectedModels.push(modelId)
  } else if (!checked && index > -1) {
    selectedModels.splice(index, 1)
  }
}

// цЙУх╝АцПРф╛ЫхХЖщЕНч╜о
const openProviderConfig = (provider) => {
  providerConfig.provider = provider
  providerConfig.providerName = modelNames.value[provider].name
  providerConfig.allModels = []
  providerConfig.visible = true
  providerConfig.loading = true
  providerConfig.searchQuery = '' // щЗНч╜оцРЬч┤вхЕ│щФошпН

  // шО╖хПЦх╜УхЙНщАЙцЛйчЪДцибхЮЛф╜Ьф╕║хИЭхзЛщАЙф╕нхА╝
  const currentModels = modelNames.value[provider]?.models || []
  providerConfig.selectedModels = [...currentModels]

  // шО╖хПЦцЙАцЬЙхПпчФицибхЮЛ
  fetchProviderModels(provider)
}

// шО╖хПЦцибхЮЛцПРф╛ЫхХЖчЪДцибхЮЛхИЧшби
const fetchProviderModels = (provider) => {
  providerConfig.loading = true
  chatApi
    .getProviderModels(provider)
    .then((data) => {
      console.log(`${provider} цибхЮЛхИЧшби:`, data)

      // хдДчРЖхРДчзНхПпшГ╜чЪДAPIш┐ФхЫЮца╝х╝П
      let modelsList = []

      // цГЕхЖ╡1: { data: [...] }
      if (data.data && Array.isArray(data.data)) {
        modelsList = data.data
      }
      // цГЕхЖ╡2: { models: [...] } (хнЧчмжф╕▓цХ░ч╗Д)
      else if (data.models && Array.isArray(data.models)) {
        modelsList = data.models.map((model) => (typeof model === 'string' ? { id: model } : model))
      }
      // цГЕхЖ╡3: { models: { data: [...] } }
      else if (data.models && data.models.data && Array.isArray(data.models.data)) {
        modelsList = data.models.data
      }

      console.log('хдДчРЖхРОчЪДцибхЮЛхИЧшби:', modelsList)
      providerConfig.allModels = modelsList
      providerConfig.loading = false
    })
    .catch((error) => {
      console.error(`шО╖хПЦ${provider}цибхЮЛхИЧшбихд▒ш┤е:`, error)
      message.error({ content: `шО╖хПЦ${modelNames.value[provider].name}цибхЮЛхИЧшбихд▒ш┤е`, duration: 2 })
      providerConfig.loading = false
    })
}

// ф┐ЭхнШцПРф╛ЫхХЖщЕНч╜о
const saveProviderConfig = async () => {
  if (!modelStatus.value[providerConfig.provider]) {
    message.error('шп╖хЬи src/.env ф╕нщЕНч╜охп╣х║ФчЪД APIKEYя╝Мх╣╢щЗНцЦ░хРпхКицЬНхКб')
    return
  }

  message.loading({ content: 'ф┐ЭхнШщЕНч╜оф╕н...', key: 'save-config', duration: 0 })

  try {
    // хПСщАБщАЙцЛйчЪДцибхЮЛхИЧшбихИ░хРОчлп
    const data = await chatApi.updateProviderModels(
      providerConfig.provider,
      providerConfig.selectedModels
    )
    console.log('цЫ┤цЦ░хРОчЪДцибхЮЛхИЧшби:', data.models)

    message.success({ content: 'цибхЮЛщЕНч╜ох╖▓ф┐ЭхнШ!', key: 'save-config', duration: 2 })

    // хЕ│щЧнх╝╣чкЧ
    providerConfig.visible = false

    // хИ╖цЦ░щЕНч╜о
    configStore.refreshConfig()
  } catch (error) {
    console.error('ф┐ЭхнШщЕНч╜охд▒ш┤е:', error)
    message.error({ content: 'ф┐ЭхнШщЕНч╜охд▒ш┤е: ' + error.message, key: 'save-config', duration: 2 })
  }
}

// хПЦц╢ИцПРф╛ЫхХЖщЕНч╜о
const cancelProviderConfig = () => {
  providerConfig.visible = false
}

// шобчоЧчнЫщАЙхРОчЪДцибхЮЛхИЧшби
const filteredModels = computed(() => {
  const allModels = providerConfig.allModels || []
  const searchQuery = providerConfig.searchQuery.toLowerCase()
  return allModels.filter((model) => model.id.toLowerCase().includes(searchQuery))
})
</script>

<style lang="less" scoped>
.model-providers-container {
  display: flex;
  height: 100%;
  gap: 24px;
  background: #f8f9fa;
  border-radius: 8px;
  overflow: hidden;
}

// х╖жф╛зхОВхХЖхИЧшби
.providers-sidebar {
  width: 280px;
  flex-shrink: 0;
  background: white;
  border-right: 1px solid var(--gray-200);
  padding: 16px;
  overflow-y: auto;

  .provider-item {
    border: 1px solid var(--gray-200);
    border-radius: 8px;
    margin-bottom: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    overflow: hidden;

    &:hover {
      border-color: var(--gray-300);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    &.active {
      border-color: var(--main-color);
      box-shadow: 0 0 0 1px var(--main-color);
    }

    &.custom-models-section {
      .provider-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;

        .provider-details h3 {
          color: white;
        }

        .provider-status {
          color: rgba(255, 255, 255, 0.8);
        }

        .custom-icon {
          background: rgba(255, 255, 255, 0.2);
          color: white;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: bold;
        }
      }
    }

    &.configured-provider {
      .provider-icon.available {
        filter: none;
      }
    }

    &.unconfigured-provider {
      .provider-header {
        background: #f8f9fa;
      }

      .provider-icon {
        filter: grayscale(100%);
        opacity: 0.6;
      }

      .provider-details h3 {
        color: var(--gray-600);
      }
    }

    .provider-header {
      padding: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      background: white;

      .provider-info {
        flex: 1;
        display: flex;
        align-items: center;
        gap: 12px;
        min-width: 0;

        .provider-icon {
          width: 36px;
          height: 36px;
          border-radius: 8px;
          overflow: hidden;
          border: 1px solid var(--gray-200);
          filter: grayscale(100%);
          transition: filter 0.2s ease;

          img {
            width: 100%;
            height: 100%;
            object-fit: cover;
          }

          &.available {
            filter: none;
          }
        }

        .provider-details {
          flex: 1;
          min-width: 0;

          h3 {
            margin: 0;
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-900);
            line-height: 1.2;
          }

          .provider-status {
            font-size: 12px;
            color: var(--gray-500);
            line-height: 1.2;
          }

          .missing-keys {
            font-size: 11px;
            color: var(--gray-600);
            margin-top: 2px;

            span {
              background: #fff7ed;
              color: #d97706;
              padding: 1px 4px;
              border-radius: 3px;
              margin-left: 4px;
              font-family: monospace;
            }
          }
        }
      }

      .provider-actions {
        display: flex;
        align-items: center;
        gap: 4px;

        .info-link {
          color: var(--gray-500);
          font-size: 14px;
          padding: 4px;
          border-radius: 4px;
          transition: all 0.2s ease;

          &:hover {
            color: var(--main-color);
            background: var(--gray-100);
          }
        }
      }
    }
  }
}

// хП│ф╛зхЖЕхо╣хМ║хЯЯ
.models-content {
  flex: 1;
  background: white;
  border-radius: 8px;
  padding: 24px;
  overflow-y: auto;

  .empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    text-align: center;
    color: var(--gray-500);

    .empty-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    h3 {
      margin: 0 0 8px 0;
      color: var(--gray-700);
    }

    p {
      margin: 0;
      font-size: 14px;
    }
  }

  .content-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 1px solid var(--gray-200);

    .header-info {
      display: flex;
      align-items: center;
      gap: 16px;

      .provider-icon {
        width: 48px;
        height: 48px;
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid var(--gray-200);

        img {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }
      }

      h2 {
        margin: 0;
        font-size: 24px;
        font-weight: 600;
        color: var(--gray-900);
      }

      .provider-description {
        margin: 4px 0 0 0;
        font-size: 14px;
        color: var(--gray-600);
      }
    }
  }

  .models-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 16px;

    .model-card {
      border: 1px solid var(--gray-200);
      border-radius: 8px;
      padding: 16px;
      background: white;
      transition: all 0.2s ease;

      &:hover {
        border-color: var(--gray-300);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      &.custom-model-card {
        .model-header {
          display: flex;
          align-items: flex-start;
          justify-content: space-between;
          margin-bottom: 12px;

          .model-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-900);
            flex: 1;
            margin-right: 8px;
          }

          .model-actions {
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.2s ease;
          }
        }

        &:hover .model-actions {
          opacity: 1;
        }

        .model-info {
          .info-item {
            display: flex;
            margin-bottom: 8px;
            font-size: 13px;

            .label {
              color: var(--gray-600);
              margin-right: 8px;
              min-width: 70px;
            }

            .value {
              color: var(--gray-900);
              word-break: break-all;
              flex: 1;
            }
          }
        }
      }

      &.provider-model-card {
        display: flex;
        align-items: center;
        justify-content: space-between;

        .model-name {
          font-size: 14px;
          font-weight: 500;
          color: var(--gray-900);
        }

        .model-status {
          font-size: 12px;
          color: #059669;
          background: #d1fae5;
          padding: 2px 8px;
          border-radius: 12px;
        }
      }
    }
  }

  .unconfigured-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 48px 24px;
    color: var(--gray-600);

    .warning-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    h3 {
      margin: 0 0 8px 0;
      color: var(--gray-700);
    }

    p {
      margin: 0 0 16px 0;
      font-size: 14px;
    }

    .env-keys {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      flex-wrap: wrap;
      justify-content: center;

      code {
        background: #f3f4f6;
        padding: 4px 8px;
        border-radius: 4px;
        font-family: monospace;
        font-size: 12px;
        color: var(--gray-700);
        border: 1px solid var(--gray-300);
      }
    }
  }
}

// х╝╣чкЧца╖х╝Пф┐ЭцМБф╕НхПШ
.custom-model-modal {
  .ant-form-item {
    margin-bottom: 10px;
    .form-item-description {
      font-size: 12px;
      color: var(--gray-600);
      margin-bottom: 10px;
    }
  }
}

.provider-config-modal {
  .ant-modal-body {
    padding: 16px 0 !important;
    .modal-loading-container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 200px;

      .loading-text {
        margin-top: 20px;
        color: var(--gray-700);
        font-size: 14px;
      }
    }

    .modal-config-content {
      max-height: 70vh;
      overflow-y: auto;

      .modal-config-header {
        margin-bottom: 20px;

        .description {
          font-size: 14px;
          color: var(--gray-600);
          margin: 0;
        }
      }

      .modal-models-section {
        .model-search {
          margin-bottom: 10px;
          padding: 0 6px;

          .ant-input-affix-wrapper {
            border-radius: 6px;
            &:hover,
            &:focus {
              border-color: var(--main-color);
            }
            .anticon {
              color: var(--gray-500);
            }
          }
        }
        .selection-summary {
          margin: 0 6px 10px;
          font-size: 14px;
          color: var(--gray-600);

          .filter-info {
            color: var(--gray-500);
          }
        }
        .modal-checkbox-list {
          max-height: 50vh;
          overflow-y: auto;
          .modal-checkbox-item {
            display: inline-block;
            margin-bottom: 4px;
            padding: 4px 6px;
            border-radius: 6px;
            background-color: white;
            border: 1px solid var(--gray-200);

            &:hover {
              background-color: var(--gray-50);
            }
          }
        }
      }
    }
  }
}

// хУНх║Фх╝Пш░ГцХ┤
@media (max-width: 1024px) {
  .model-providers-container {
    flex-direction: column;
    height: auto;

    .providers-sidebar {
      width: 100%;
      max-height: 300px;
    }

    .models-content {
      padding: 16px;

      .models-grid {
        grid-template-columns: 1fr;
      }
    }
  }
}

@media (max-width: 768px) {
  .providers-sidebar {
    padding: 12px;

    .provider-item .provider-header {
      padding: 8px;
      gap: 8px;

      .provider-info .provider-icon {
        width: 32px;
        height: 32px;
      }

      .provider-details h3 {
        font-size: 13px;
      }
    }
  }

  .models-content {
    padding: 12px;

    .content-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 16px;

      .header-info .provider-icon {
        width: 40px;
        height: 40px;
      }

      h2 {
        font-size: 20px;
      }
    }
  }
}
</style>